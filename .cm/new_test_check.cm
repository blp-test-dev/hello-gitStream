# -*- mode: yaml -*-
manifest:
  version: 1.0

newFiles: {{ source.diff.files | filter(attr='new_file', regex=r/src\/.*\.js$/) | filter(attr='original_file', regex=r/^$/) | map(attr='new_file') }}
newTests: {{ source.diff.files | filter(attr='new_file', regex=r/src\/.*\.test\.js$/) | filter(attr='original_file', regex=r/^$/) | map(attr='new_file') }}

{% set missList = [] %}
{% for file in newFiles %}
{% set parsedName = (file | capture(regex=r/(.*)(?=.js$)/)) %}
{% if (newTests | match(term=parsedName) | nope ) %}
{% set missList = missList + [parsedName.test.js] %}
{% endif %}
{% endfor %} 

automations:
  new_files_check:
    if:
      - true
    run: 
      - action: add-comment@v1
        args:
          comment: {{comment_text}}

comment_text: |
  **The following tests are missing for new files in this PR:**
  {% for item in missList %}
  * {{ item }}

  {% endfor %}
