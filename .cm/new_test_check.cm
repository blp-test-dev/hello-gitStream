# -*- mode: yaml -*-
manifest:
  version: 1.0

newFiles: {{ source.diff.files | filter(attr='new_file', regex=r/^src\/(?!.*\.test\.js$).*\.js$/) | filter(attr='original_file', regex=r/^$/) | map(attr='new_file') }}
newTests: {{ source.diff.files | filter(attr='new_file', regex=r/src\/.*\.test\.js$/) | filter(attr='original_file', regex=r/^$/) | map(attr='new_file') }}

newFilesCount: {{ source.diff.files | filter(attr='new_file', regex=r/^src\/(?!.*\.test\.js$).*\.js$/) | filter(attr='original_file', regex=r/^$/) | length }}
newTestsCount: {{ source.diff.files | filter(attr='new_file', regex=r/src\/.*\.test\.js$/) | filter(attr='original_file', regex=r/^$/) | length }}

automations:
  new_files_check:
    if:
      - {{ newFilesCount != newTestsCount }}
    run: 
      - action: add-comment@v1
        args:
          comment: |
            There are {{ newFilesCount }} new files and {{ newTestsCount }} new tests.
            Please ensure that all new files have a corresponding test file.

            **New Files**
            {{ newFiles }}

            **New Tests**
            {{ newTests }}
